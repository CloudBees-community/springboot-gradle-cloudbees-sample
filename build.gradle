buildscript {
    repositories {
        maven { url "http://repo.spring.io/libs-snapshot" }
        mavenLocal()
    }
    dependencies {
        classpath("org.springframework.boot:spring-boot-gradle-plugin:0.5.0.M6")
        classpath 'org.gradle.api.plugins:gradle-cloudbees-plugin:0.1.1-SNAPSHOT'
    }
}

apply plugin: 'java'
apply plugin: 'spring-boot'
apply plugin: 'cloudbees'

version =  '0.1.0'

jar {
    baseName = 'gs-spring-boot'
    version =  project.version
}

mainClassName = "com.msgilligan.springboot.hello.Application"

repositories {
    mavenCentral()
    maven {
        url 'http://repo.spring.io/milestone'
    }
}

dependencies {
    compile "org.springframework.boot:spring-boot-starter-web:0.5.0.M5"
    testCompile("junit:junit:4.11")
}

def allJars = configurations.compile.files.collect()
allJars.add(file("build/libs/gs-spring-boot-0.1.0.jar"))
def cloudBeesClasspath = allJars.collect{ "lib/" + it.name }.join(':')

def springBootJarLauncherClassName = "org.springframework.boot.loader.JarLauncher"
def springBootJarFile = file("build/libs/gs-spring-boot-0.1.0.jar")

cloudBees {
    apiKey = cloudbeesApiKey
    apiSecret = cloudbeesApiSecret
//    appId = 'cmt/btc'
    appId = 'cmt/jar'
//    archiveType = 'zip'
    archiveType = 'jar'
//    archiveFile = springBootJarFile
    archiveFile = springBootJarFile
    deltaDeploy = true
//    parameters = [containerType: "java", 'runtime.class': mainClassName, 'runtime.classpath': cloudBeesClasspath]
    parameters = [containerType: "java", 'runtime.class': springBootJarLauncherClassName, 'runtime.classpath': '']
}

cloudBeesAppDeployArchive.message = project.version

cloudBeesAppDeployArchive.dependsOn assemble

//task zipBees(type: Zip, dependsOn: installApp) {
//    destinationDir  file("${rootDir}/build")
//    from "build/install/spring-boot-gradle"
//    baseName 'gs-spring-boot'
//    version = '0.1.0'
//}

